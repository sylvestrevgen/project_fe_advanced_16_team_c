"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}var renderFilms,genres,inputValue,list=document.querySelector(".main__block"),pageNumber=1,createCardFunc=function(e,t,r){var a=document.createElement("li"),n=document.createElement("div"),i=document.createElement("img"),o=document.createElement("p"),l=document.createElement("div");return a.classList.add("film__block"),n.classList.add("film__block--wrapper"),o.classList.add("film__block--name"),l.classList.add("overlay"),a.dataset.id=r,i.setAttribute("src","https://image.tmdb.org/t/p/w500/".concat(e)),i.setAttribute("alt",t),o.textContent="".concat(t),a.append(n),n.append(i),n.append(o),n.append(l),a.addEventListener("click",function(e){return activeDetailsPage(r,!1)}),a},fetchPopularMoviesList=function(){fetch("https://api.themoviedb.org/3/movie/popular?api_key=be5814d92900bfa53e515c0fd30f3d51&language=en-US&page=".concat(pageNumber)).then(function(e){if(e.ok)return e.json();throw new Error}).then(function(e){list.innerHTML="";var t=e.results,r=t.map(function(e){return createCardFunc(e.backdrop_path,e.title,e.id)});list.append.apply(list,_toConsumableArray(r)),renderFilms=t}).catch(function(e){return console.log(e)})},fetchGenres=function(){fetch("https://api.themoviedb.org/3/genre/movie/list?api_key=be5814d92900bfa53e515c0fd30f3d51&language=en-US").then(function(e){if(e.ok)return e.json();throw new Error}).then(function(e){var t=e.genres;genres=t}).catch(function(e){return console.log(e)})};function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}fetchPopularMoviesList(),fetchGenres();var selectFilm,refs={formSearch:document.querySelector("form.form__search"),btnPrev:document.querySelector(".plaginator__btn--prev"),btnNext:document.querySelector(".plaginator__btn--next"),pageContainer:document.querySelector("ul.main__block"),searchErrMessage:document.querySelector(".form__error--paragraf"),pagePlaginationContainer:document.querySelector(".plaginator__container"),pageNumber:document.querySelector('[data-info="page-number-box"]')},fetchFilms=function(){fetch("https://api.themoviedb.org/3/search/movie?api_key=be5814d92900bfa53e515c0fd30f3d51&language=en-US&page=".concat(pageNumber,"&query=").concat(inputValue,"&include_adult=false")).then(function(e){if(e.ok)return e.json();throw new Error("Error fetching")}).then(function(e){var t,r=e.results,a=r.map(function(e){return createCardFunc(e.backdrop_path,e.title,e.id)});refs.pageContainer.innerHTML="",(t=refs.pageContainer).append.apply(t,_toConsumableArray(a)),renderFilms=r}).catch(function(e){refs.searchErrMessage.classList.toggle("hidden"),refs.searchErrMessage.textContent=e})},searchFilms=function(){event.preventDefault(),inputValue=document.querySelector(".form__search .form__input").value,fetchFilms(),refs.formSearch.reset()},plaginationNavigation=function(e){if("button-prev"===e.target.dataset.action){if(pageNumber<=1)return void refs.btnPrev.classList.add("plaginator__btn--opacity");if(pageNumber-=1,refs.pageNumber.textContent=pageNumber,inputValue?fetchFilms():(fetchPopularMoviesList(),inputValue=""),pageNumber<=1)return void refs.btnPrev.classList.add("plaginator__btn--opacity")}"button-next"===e.target.dataset.action&&(pageNumber+=1,refs.pageNumber.textContent=pageNumber,refs.btnPrev.classList.remove("plaginator__btn--opacity"),inputValue?fetchFilms():(fetchPopularMoviesList(),inputValue=""))};refs.pageNumber.textContent=pageNumber,refs.btnPrev.classList.add("plaginator__btn--opacity"),refs.formSearch.addEventListener("submit",searchFilms),refs.pagePlaginationContainer.addEventListener("click",plaginationNavigation);var logo=document.querySelector(".logo-home"),linkHome=document.querySelector(".link-home"),linkLibrary=document.querySelector(".link-library"),homePage=document.querySelector(".home-page"),prev=document.querySelector(".plaginator__btn--prev"),next=document.querySelector(".plaginator__btn--next"),libraryWatched=document.querySelector(".library-watched"),libraryQueue=document.querySelector(".library-queue"),detail=document.querySelector(".film__container"),AddToWatch=document.querySelector(".button-watch"),AddToQueue=document.querySelector(".button-queue"),libBtnSection=document.querySelector(".section__library--btn"),arrow=document.querySelector(".arrow"),libBtns={watchBtn:document.querySelector('[data-action="lib-watch-button"]'),queueBtn:document.querySelector('[data-action="lib-queue-button"]')};function activeHomePage(){libBtnSection.classList.add("hidden"),homePage.classList.remove("hidden"),detail.classList.add("hidden"),libraryWatched.classList.add("hidden"),libraryQueue.classList.add("hidden"),linkHome.classList.add("link-active"),linkLibrary.classList.remove("link-active"),fetchPopularMoviesList(),prev.addEventListener("click",plaginationNavigation),next.addEventListener("click",plaginationNavigation),linkHome.removeEventListener("click",activeHomePage),linkLibrary.addEventListener("click",activeLibraryPage)}function activeLibraryPage(){libBtnSection.classList.remove("hidden"),homePage.classList.add("hidden"),detail.classList.add("hidden"),linkHome.classList.remove("link-active"),linkLibrary.classList.add("link-active"),showPageWatch(),libBtns.watchBtn.removeEventListener("click",showPageWatch),libBtns.queueBtn.addEventListener("click",showPageQueue),linkLibrary.removeEventListener("click",activeLibraryPage),linkHome.addEventListener("click",activeHomePage)}function showPageWatch(){libraryWatched.classList.remove("hidden"),libraryQueue.classList.add("hidden"),libBtnSection.classList.remove("hidden"),libBtns.watchBtn.removeEventListener("click",showPageWatch),libBtns.queueBtn.addEventListener("click",showPageQueue),drawWatchedFilmList()}function showPageQueue(){libraryWatched.classList.add("hidden"),libraryQueue.classList.remove("hidden"),libBtnSection.classList.remove("hidden"),libBtns.watchBtn.addEventListener("click",showPageWatch),libBtns.queueBtn.removeEventListener("click",showPageQueue),drawQueueFilmList()}function activeDetailsPage(t,e){try{if(homePage.classList.add("hidden"),detail.classList.remove("hidden"),libBtnSection.classList.add("hidden"),libraryWatched.classList.add("hidden"),libraryQueue.classList.add("hidden"),e){var r=JSON.parse(localStorage.getItem("filmsQueue"));(selectFilm=r.find(function(e){return e.id===t}))===undenfined&&(r=JSON.parse(localStorage.getItem("filmsWatched")),selectFilm=r.find(function(e){return e.id===t})),showDetails(selectFilm)}else{selectFilm=renderFilms.find(function(e){return e.id===t}),showDetails(selectFilm)}AddToWatch.addEventListener("click",toggleToWatched),AddToQueue.addEventListener("click",toggleToQueue),detail.removeEventListener("click",activeDetailsPage)}catch(e){console.log(e)}}function arrowUp(){window.scrollBy(0,-8e3)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}linkHome.addEventListener("click",activeHomePage),logo.addEventListener("click",activeHomePage),linkLibrary.addEventListener("click",activeLibraryPage),arrow.addEventListener("click",arrowUp);var poster=document.querySelector(".film__list--img"),title=document.querySelector(".film__name"),vote_average=document.querySelector(".film--vote"),popularity=document.querySelector(".film--popularity"),original_title=document.querySelector(".film--or_title"),genre=document.querySelector(".film--genre"),description=document.querySelector(".film__about--description");function toggleToQueue(){var e,t=[],r=localStorage.getItem("filmsQueue");null!==r&&(e=t).push.apply(e,_toConsumableArray(JSON.parse(r)));t.find(function(e){return e.id===selectFilm.id})?t=t.filter(function(e){return e.id!==selectFilm.id}):t.push(selectFilm),localStorage.setItem("filmsQueue",JSON.stringify(t)),monitorButtonStatusText()}function toggleToWatched(){var e,t=[],r=localStorage.getItem("filmsWatched");null!==r&&(e=t).push.apply(e,_toConsumableArray(JSON.parse(r)));t.find(function(e){return e.id===selectFilm.id})?t=t.filter(function(e){return e.id!==selectFilm.id}):t.push(selectFilm),localStorage.setItem("filmsWatched",JSON.stringify(t)),monitorButtonStatusText()}var showDetails=function(e){poster.src="https://image.tmdb.org/t/p/w500".concat(e.poster_path),title.textContent=e.title,vote_average.textContent=e.vote_average,popularity.textContent=e.popularity,original_title.textContent=e.original_title;var t=_toConsumableArray(e.genre_ids),r=genres.filter(function(e){return t.includes(e.id)}).map(function(e){return e.name}).join(", ");genre.textContent=r,description.textContent=e.overview,monitorButtonStatusText()};function monitorButtonStatusText(){var e=localStorage.getItem("filmsQueue");null===e?AddToQueue.textContent="Add to queue":JSON.parse(e).find(function(e){return e.id===selectFilm.id})?AddToQueue.textContent="Delete from queue":AddToQueue.textContent="Add to queue";var t=localStorage.getItem("filmsWatched");null===t?AddToWatch.textContent="Add to watched":JSON.parse(t).find(function(e){return e.id===selectFilm.id})?AddToWatch.textContent="Delete from watched":AddToWatch.textContent="Add to watched"}var libQueueClass="library-queue",libWatchedClass="library-watched",libFilmsContainerClass="__films-container",libFilmClass="__films-container--film",libFilmImgClass="__films-container--film-img",libFilmNameClass="__films-container--film-name",libFilmRateClass="__films-container--film-rate",libQueueFilmsContainer=document.querySelector(".library-queue__films-container"),libWatchedFilmsContainer=document.querySelector(".library-watched__films-container");function addLibUlListener(e){var t=e.target;"LI"===t.nodeName&&activeDetailsPage(t.dataset.id,!0),"IMG"===t.nodeName&&activeDetailsPage(t.parentNode.dataset.id,!0)}function createLibraryCardFunc(e,t,r,a){var n=document.createElement("li"),i=document.createElement("img"),o=document.createElement("p"),l=document.createElement("p");return n.dataset.id=r,i.src="https://image.tmdb.org/t/p/w500/".concat(e),o.textContent=t,l.textContent=a,n.appendChild(i),n.appendChild(o),n.appendChild(l),n}function drawQueueFilmList(){var e=localStorage.getItem("filmsQueue"),t=JSON.parse(e);libQueueFilmsContainer.innerHTML="",t!==[]&&""!==t&&null!==t?t.forEach(function(e){var t=createLibraryCardFunc(e.backdrop_path,e.title,e.id,e.vote_average);addClassesForLibListLi("library-watched",t),libQueueFilmsContainer.appendChild(t)}):libQueueFilmsContainer.innerHTML="You don't have queue movies to watch. Add them.",libBtns.queueBtn.classList.add("library__btn--active"),libBtns.watchBtn.classList.remove("library__btn--active")}function drawWatchedFilmList(){var e=localStorage.getItem("filmsWatched"),t=JSON.parse(e);libWatchedFilmsContainer.innerHTML="",t!==[]&&""!==t&&null!==t?t.forEach(function(e){var t=createLibraryCardFunc(e.backdrop_path,e.title,e.id,e.vote_average);addClassesForLibListLi("library-queue",t),libWatchedFilmsContainer.appendChild(t)}):libWatchedFilmsContainer.innerHTML="You haven't watched any movies. Add them.",libBtns.queueBtn.classList.remove("library__btn--active"),libBtns.watchBtn.classList.add("library__btn--active")}function addClassesForLibListLi(e,t){t.classList.add(e+"__films-container--film"),t.querySelector("img").classList.add(e+"__films-container--film-img");var r=t.querySelectorAll("p");r[0].classList.add(e+"__films-container--film-name"),r[1].classList.add(e+"__films-container--film-rate")}libQueueFilmsContainer.addEventListener("click",addLibUlListener),libWatchedFilmsContainer.addEventListener("click",addLibUlListener);