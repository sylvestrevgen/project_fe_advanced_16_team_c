"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}var renderFilms,genres,inputValue,list=document.querySelector(".main__block"),pageNumber=1,createCardFunc=function(e,t,a){var i=document.createElement("li"),r=document.createElement("div"),n=document.createElement("img"),o=document.createElement("p"),l=document.createElement("div");return i.classList.add("film__block"),r.classList.add("film__block--wrapper"),o.classList.add("film__block--name"),l.classList.add("overlay"),i.dataset.id=a,n.classList.add("film__block--img"),e?n.setAttribute("src","https://image.tmdb.org/t/p/w500/".concat(e)):(e="../images/image-not-found.png",n.setAttribute("src","".concat(e)),n.classList.remove("film__block--img"),n.classList.add("film__block--img-not-find")),n.setAttribute("alt",t),o.textContent="".concat(t),i.append(r),r.append(n),r.append(o),r.append(l),i.addEventListener("click",function(e){return activeDetailsPage(a,!1)}),i},fetchPopularMoviesList=function(){fetch("https://api.themoviedb.org/3/movie/popular?api_key=be5814d92900bfa53e515c0fd30f3d51&language=en-US&page=".concat(pageNumber)).then(function(e){if(e.ok)return e.json();throw new Error}).then(function(e){list.innerHTML="";var t=e.results,a=t.map(function(e){return createCardFunc(e.backdrop_path,e.title,e.id)});list.append.apply(list,_toConsumableArray(a)),renderFilms=t}).catch(function(e){return console.log(e)})},fetchGenres=function(){fetch("https://api.themoviedb.org/3/genre/movie/list?api_key=be5814d92900bfa53e515c0fd30f3d51&language=en-US").then(function(e){if(e.ok)return e.json();throw new Error}).then(function(e){var t=e.genres;genres=t}).catch(function(e){return console.log(e)})};function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}fetchPopularMoviesList(),fetchGenres();var selectFilm,refs={formSearch:document.querySelector("form.form__search"),btnPrev:document.querySelector(".plaginator__btn--prev"),btnNext:document.querySelector(".plaginator__btn--next"),pageContainer:document.querySelector("ul.main__block"),searchErrMessage:document.querySelector(".form__error--paragraf"),pagePlaginationContainer:document.querySelector(".plaginator__container"),pageNumber:document.querySelector('[data-info="page-number-box"]')},fetchFilms=function(){fetch("https://api.themoviedb.org/3/search/movie?api_key=be5814d92900bfa53e515c0fd30f3d51&language=en-US&page=".concat(pageNumber,"&query=").concat(inputValue,"&include_adult=false")).then(function(e){if(e.ok)return e.json();throw new Error("Error fetching")}).then(function(e){var t,a=e.results,i=a.map(function(e){return createCardFunc(e.backdrop_path,e.title,e.id)});refs.pageContainer.innerHTML="",(t=refs.pageContainer).append.apply(t,_toConsumableArray(i)),renderFilms=a}).catch(function(e){refs.searchErrMessage.classList.toggle("hidden"),refs.searchErrMessage.textContent=e})},pageBeginOptions=function(){pageNumber=1,refs.pageNumber.textContent=pageNumber,refs.btnPrev.classList.add("plaginator__btn--opacity")},changePage=function(e){e(),setTimeout(function(){window.scrollBy(0,-8e3),refs.pageNumber.textContent=pageNumber},0)},searchFilms=function(){event.preventDefault(),inputValue=document.querySelector(".form__search .form__input").value,fetchFilms(),pageBeginOptions(),refs.formSearch.reset()},plaginationNavigation=function(e){if("button-prev"===e.target.dataset.action){if(pageNumber<=1)return void refs.btnPrev.classList.add("plaginator__btn--opacity");if(pageNumber-=1,inputValue?changePage(fetchFilms):(inputValue="",changePage(fetchPopularMoviesList)),pageNumber<=1)return void refs.btnPrev.classList.add("plaginator__btn--opacity")}"button-next"===e.target.dataset.action&&(pageNumber+=1,setTimeout(function(){return refs.btnPrev.classList.remove("plaginator__btn--opacity")},300),inputValue?changePage(fetchFilms):(inputValue="",changePage(fetchPopularMoviesList)))};refs.pageNumber.textContent=pageNumber,refs.btnPrev.classList.add("plaginator__btn--opacity"),refs.formSearch.addEventListener("submit",searchFilms),refs.pagePlaginationContainer.addEventListener("click",plaginationNavigation);var logo=document.querySelector(".logo-home"),linkHome=document.querySelector(".link-home"),linkLibrary=document.querySelector(".link-library"),homePage=document.querySelector(".home-page"),prev=document.querySelector(".plaginator__btn--prev"),next=document.querySelector(".plaginator__btn--next"),libraryWatched=document.querySelector(".library-watched"),libraryQueue=document.querySelector(".library-queue"),detail=document.querySelector(".film__container"),AddToWatch=document.querySelector(".button-watch"),AddToQueue=document.querySelector(".button-queue"),libBtnSection=document.querySelector(".section__library--btn"),arrow=document.querySelector(".arrow"),header=document.querySelector(".page-header"),libBtns={watchBtn:document.querySelector('[data-action="lib-watch-button"]'),queueBtn:document.querySelector('[data-action="lib-queue-button"]')},footerWord=document.querySelector(".footer-word"),pageDevelopers=document.querySelector(".page-developers");function activeHomePage(){libBtnSection.classList.add("hidden"),homePage.classList.remove("hidden"),detail.classList.add("hidden"),libraryWatched.classList.add("hidden"),libraryQueue.classList.add("hidden"),pageDevelopers.classList.add("hidden"),linkHome.classList.add("link-active"),linkLibrary.classList.remove("link-active"),refs.pagePlaginationContainer.removeEventListener("click",plaginationNavigation),pageBeginOptions(),inputValue="",fetchPopularMoviesList(),prev.addEventListener("click",plaginationNavigation),next.addEventListener("click",plaginationNavigation),linkHome.removeEventListener("click",activeHomePage),linkLibrary.addEventListener("click",activeLibraryPage)}function activeLibraryPage(){libBtnSection.classList.remove("hidden"),homePage.classList.add("hidden"),detail.classList.add("hidden"),pageDevelopers.classList.add("hidden"),linkHome.classList.remove("link-active"),linkLibrary.classList.add("link-active"),showPageWatch(),libBtns.watchBtn.removeEventListener("click",showPageWatch),libBtns.queueBtn.addEventListener("click",showPageQueue),linkLibrary.removeEventListener("click",activeLibraryPage),linkHome.addEventListener("click",activeHomePage)}function showPageWatch(){libraryWatched.classList.remove("hidden"),libraryQueue.classList.add("hidden"),libBtnSection.classList.remove("hidden"),libBtns.watchBtn.removeEventListener("click",showPageWatch),libBtns.queueBtn.addEventListener("click",showPageQueue),pageDevelopers.classList.add("hidden"),drawWatchedFilmList()}function showPageQueue(){libraryWatched.classList.add("hidden"),libraryQueue.classList.remove("hidden"),libBtnSection.classList.remove("hidden"),libBtns.watchBtn.addEventListener("click",showPageWatch),libBtns.queueBtn.removeEventListener("click",showPageQueue),pageDevelopers.classList.add("hidden"),drawQueueFilmList()}function activeDetailsPage(t,e){try{if(homePage.classList.add("hidden"),detail.classList.remove("hidden"),libBtnSection.classList.add("hidden"),libraryWatched.classList.add("hidden"),libraryQueue.classList.add("hidden"),pageDevelopers.classList.add("hidden"),e){var a=JSON.parse(localStorage.getItem("filmsQueue"));void 0===(selectFilm=a.find(function(e){return e.id===Number(t)}))&&(a=JSON.parse(localStorage.getItem("filmsWatched")),selectFilm=a.find(function(e){return e.id===Number(t)})),showDetails(selectFilm)}else{selectFilm=renderFilms.find(function(e){return e.id===Number(t)}),showDetails(selectFilm)}AddToWatch.addEventListener("click",toggleToWatched),AddToQueue.addEventListener("click",toggleToQueue),linkLibrary.addEventListener("click",activeLibraryPage),detail.removeEventListener("click",activeDetailsPage)}catch(e){console.log("activeDetailsPage",e)}}function arrowUp(){0<window.pageYOffset&&(window.scrollBy(0,-80),setTimeout(function(){return arrowUp()},20))}function arrowUpShow(){setTimeout(function(){65<window.pageYOffset?arrow.classList.remove("hidden"):window.pageYOffset<=65&&arrow.classList.add("hidden")},300)}function showDevelopers(){homePage.classList.add("hidden"),detail.classList.add("hidden"),libBtnSection.classList.add("hidden"),libraryWatched.classList.add("hidden"),libraryQueue.classList.add("hidden"),pageDevelopers.classList.remove("hidden"),linkHome.addEventListener("click",activeHomePage),logo.addEventListener("click",activeHomePage),linkLibrary.addEventListener("click",activeLibraryPage),linkLibrary.removeEventListener("click",showDevelopers)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}linkHome.addEventListener("click",activeHomePage),logo.addEventListener("click",activeHomePage),linkLibrary.addEventListener("click",activeLibraryPage),arrow.addEventListener("click",arrowUp),addEventListener("scroll",arrowUpShow),footerWord.addEventListener("click",showDevelopers);var poster=document.querySelector(".film__list--img"),title=document.querySelector(".film__name"),vote_average=document.querySelector(".film--vote"),popularity=document.querySelector(".film--popularity"),original_title=document.querySelector(".film--or_title"),genre=document.querySelector(".film--genre"),description=document.querySelector(".film__about--description"),monitorButtonStatusText=function(){try{var e=localStorage.getItem("filmsQueue");JSON.parse(e).find(function(e){return e.id===selectFilm.id})?AddToQueue.textContent="Delete from queue":AddToQueue.textContent="Add to queue";var t=localStorage.getItem("filmsWatched");null===t?AddToWatch.textContent="Add to watch":JSON.parse(t).find(function(e){return e.id===selectFilm.id})?AddToWatch.textContent="Delete from watched":AddToWatch.textContent="Add to watch"}catch(e){console.error("monitorButtonStatusText",e)}},toggleToQueue=function(){var e=[];try{var t,a=localStorage.getItem("filmsQueue");if(null!==a)(t=e).push.apply(t,_toConsumableArray(JSON.parse(a)));e.find(function(e){return e.id===selectFilm.id})?e=e.filter(function(e){return e.id!==selectFilm.id}):e.push(selectFilm),localStorage.setItem("filmsQueue",JSON.stringify(e)),monitorButtonStatusText()}catch(e){console.error("toggleToQueue",e)}},toggleToWatched=function(){try{var e,t=[],a=localStorage.getItem("filmsWatched");if(null!==a)(e=t).push.apply(e,_toConsumableArray(JSON.parse(a)));t.find(function(e){return e.id===selectFilm.id})?t=t.filter(function(e){return e.id!==selectFilm.id}):t.push(selectFilm),localStorage.setItem("filmsWatched",JSON.stringify(t)),monitorButtonStatusText()}catch(e){console.error("toggleToWatched",e)}},showDetails=function(e){poster.src="https://image.tmdb.org/t/p/w500".concat(e.poster_path),title.textContent=e.title,vote_average.textContent=e.vote_average,popularity.textContent=e.popularity,original_title.textContent=e.original_title;var t=_toConsumableArray(e.genre_ids),a=genres.filter(function(e){return t.includes(e.id)}).map(function(e){return e.name}).join(", ");genre.textContent=a,description.textContent=e.overview,monitorButtonStatusText()},libQueueClass="library-queue",libWatchedClass="library-watched",libFilmsContainerClass="__films-container",libFilmClass="__films-container--film",libFilmImgClass="__films-container--film-img",libFilmNameClass="__films-container--film-name",libFilmRateClass="__films-container--film-rate",libQueueFilmsContainer=document.querySelector(".library-queue__films-container"),libWatchedFilmsContainer=document.querySelector(".library-watched__films-container");function addLibUlListener(e){var t=e.target;"LI"===t.nodeName&&activeDetailsPage(t.dataset.id,!0),"IMG"===t.nodeName&&activeDetailsPage(t.parentNode.dataset.id,!0)}function createLibraryCardFunc(e,t,a,i){var r=document.createElement("li"),n=document.createElement("img"),o=document.createElement("p"),l=document.createElement("p");return r.dataset.id=a,n.src="https://image.tmdb.org/t/p/w500/".concat(e),o.textContent=t,l.textContent=i,r.appendChild(n),r.appendChild(o),r.appendChild(l),r}function drawQueueFilmList(){var e=localStorage.getItem("filmsQueue"),t=JSON.parse(e);libQueueFilmsContainer.innerHTML="",t!==[]&&""!==t&&null!==t?t.forEach(function(e){var t=createLibraryCardFunc(e.backdrop_path,e.title,e.id,e.vote_average);addClassesForLibListLi("library-watched",t),libQueueFilmsContainer.appendChild(t)}):libQueueFilmsContainer.innerHTML="You don't have queue movies to watch. Add them.",libBtns.queueBtn.classList.add("library__btn--active"),libBtns.watchBtn.classList.remove("library__btn--active")}function drawWatchedFilmList(){var e=localStorage.getItem("filmsWatched"),t=JSON.parse(e);libWatchedFilmsContainer.innerHTML="",t!==[]&&""!==t&&null!==t?t.forEach(function(e){var t=createLibraryCardFunc(e.backdrop_path,e.title,e.id,e.vote_average);addClassesForLibListLi("library-queue",t),libWatchedFilmsContainer.appendChild(t)}):libWatchedFilmsContainer.innerHTML="You haven't watched any movies. Add them.",libBtns.queueBtn.classList.remove("library__btn--active"),libBtns.watchBtn.classList.add("library__btn--active")}function addClassesForLibListLi(e,t){t.classList.add(e+"__films-container--film"),t.querySelector("img").classList.add(e+"__films-container--film-img");var a=t.querySelectorAll("p");a[0].classList.add(e+"__films-container--film-name"),a[1].classList.add(e+"__films-container--film-rate")}libQueueFilmsContainer.addEventListener("click",addLibUlListener),libWatchedFilmsContainer.addEventListener("click",addLibUlListener);